## Elastic Compute Cloud (EC2)

## 🧠 What EC2 Really Is

EC2 = **Elastic Compute Cloud** → basically means:

> “You can rent virtual computers (servers) on demand.”

Think of it as your own **computer in the cloud**:

* You choose how powerful it is (CPU, RAM)
* Which OS it runs (Linux, Windows, Mac)
* How much storage it has (EBS, EFS)
* What kind of network and IP it gets
* What security/firewall rules apply

💡 **Elastic** means it can scale up or down anytime — manually or automatically.

---

## ⚙️ Key EC2 Components

| Feature                         | Meaning                                      | Example                         |
| ------------------------------- | -------------------------------------------- | ------------------------------- |
| **Instance**                    | The actual virtual machine                   | “t2.micro” running Ubuntu       |
| **EBS (Elastic Block Store)**   | Persistent storage like a virtual hard drive | `/dev/xvda` mounted on instance |
| **EFS (Elastic File System)**   | Shared file system between many instances    | Web app shared folder           |
| **ELB (Elastic Load Balancer)** | Distributes traffic across instances         | Round-robin load balancing      |
| **ASG (Auto Scaling Group)**    | Automatically increases/decreases instances  | Add 2 more when CPU > 70%       |
| **Security Group**              | Firewall for inbound/outbound rules          | Allow port 22 (SSH), 80 (HTTP)  |
| **User Data**                   | Script run on first boot                     | Install Apache automatically    |

---

## 🧰 EC2 User Data (Bootstrapping)

When you launch an instance, you can include a script (Bash, PowerShell, etc.) that runs **once** when the instance starts.

**Example (Linux):**

```bash
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "Hello from EC2" > /var/www/html/index.html
```

✅ Installs Apache
✅ Starts it
✅ Hosts a simple webpage

This automation helps deploy ready-to-use servers in seconds.

---

## 🧩 EC2 Instance Types — Choosing the Right One

| Category                              | Focus                         | Typical Use                         |
| ------------------------------------- | ----------------------------- | ----------------------------------- |
| **General Purpose (e.g. t2, t3, m5)** | Balanced CPU, memory, network | Web apps, small DBs                 |
| **Compute Optimized (e.g. c5, c6g)**  | High CPU power                | Batch processing, ML, game servers  |
| **Memory Optimized (e.g. r5, x2g)**   | Large RAM                     | Databases, analytics, caching       |
| **Storage Optimized (e.g. i3, d2)**   | Fast local disk I/O           | Data warehouses, OLTP, file systems |

**Example instance:**

```
m5.2xlarge
m → general purpose
5 → 5th generation
2xlarge → specific size (8 vCPUs, 32GB RAM)
```

---

## ⚡ Example Comparison Table

| Instance    | vCPU | Memory  | Storage            | Network       | EBS Bandwidth |
| ----------- | ---- | ------- | ------------------ | ------------- | ------------- |
| t2.micro    | 1    | 1 GiB   | EBS only           | Low           | -             |
| t2.xlarge   | 4    | 16 GiB  | EBS only           | Moderate      | -             |
| c5d.4xlarge | 16   | 32 GiB  | 1 × 400GB NVMe SSD | Up to 10 Gbps | 4,750         |
| r5.16xlarge | 64   | 512 GiB | EBS only           | 20 Gbps       | 13,600        |
| m5.8xlarge  | 32   | 128 GiB | EBS only           | 10 Gbps       | 6,800         |

---

## 🧭 EC2 = Foundation of Cloud Architecture

Learning EC2 gives you the base for:

* Load balancing (ELB)
* Auto scaling (ASG)
* Security groups (network protection)
* AMIs (custom machine templates)
* EBS snapshots and backups
* Integration with S3, RDS, CloudWatch, and Lambda

---

## 🧱 What is a Security Group (SG)?

A **Security Group** is basically a **virtual firewall** attached to your EC2 instance.
It decides what kind of **network traffic is allowed in or out** of your instance.

### 🔁 Simple Mental Model

```
      🌐 Internet
           │
           ▼
     [ Security Group ]
           │
           ▼
     [ EC2 Instance ]
```

If a request comes from the internet → it must **pass through the SG rules** before reaching EC2.

---

## 🧩 Core Rules

| Rule Type          | Direction                 | Description                           | Default       |
| ------------------ | ------------------------- | ------------------------------------- | ------------- |
| **Inbound Rules**  | Incoming traffic to EC2   | Who can connect and on which port     | ❌ All Blocked |
| **Outbound Rules** | Outgoing traffic from EC2 | What destinations the EC2 can talk to | ✅ All Allowed |

💡 **Only “Allow” rules** exist — there’s **no concept of “Deny”** in security groups.

---

## 🎯 Security Group Rule Example

| Type  | Protocol | Port Range | Source          |
| ----- | -------- | ---------- | --------------- |
| SSH   | TCP      | 22         | 203.0.113.10/32 |
| HTTP  | TCP      | 80         | 0.0.0.0/0       |
| HTTPS | TCP      | 443        | 0.0.0.0/0       |

**Meaning:**

* Port **22 (SSH)** open only for your IP (safe)
* Port **80, 443** open for everyone (public website access)

---

## 🔍 Key Concepts to Remember

| Concept                   | Explanation                                                                   |
| ------------------------- | ----------------------------------------------------------------------------- |
| **Attached to Instances** | You can assign 1+ SGs per EC2                                                 |
| **Shared SGs**            | Same SG can be attached to many EC2s                                          |
| **Region/VPC Bound**      | SGs belong to a specific **region** and **VPC**                               |
| **Stateful**              | If inbound allows traffic, the response outbound is **automatically allowed** |
| **Outside the EC2**       | SG filters traffic **before** it reaches the instance                         |
| **Default Behavior**      | Inbound ❌ blocked, Outbound ✅ allowed                                         |

---

## ⚠️ Troubleshooting with SGs

| Symptom                   | Likely Cause                             |
| ------------------------- | ---------------------------------------- |
| **Timeout** (no response) | SG or network issue — traffic blocked    |
| **Connection Refused**    | App not running on EC2 or wrong port     |
| **Can’t SSH (port 22)**   | SG inbound rule missing or keypair issue |

---

## ⚙️ Classic Port Numbers to Remember

| Port | Protocol | Use                  |
| ---- | -------- | -------------------- |
| 22   | SSH      | Linux login          |
| 21   | FTP      | File transfer        |
| 22   | SFTP     | Secure file transfer |
| 80   | HTTP     | Website (unsecured)  |
| 443  | HTTPS    | Website (secured)    |
| 3389 | RDP      | Windows login        |

---

## 💻 SSH (Secure Shell) Access Methods

| Method                   | Platform    | Description                                    |
| ------------------------ | ----------- | ---------------------------------------------- |
| **SSH (CLI)**            | macOS/Linux | `ssh -i key.pem ec2-user@<Public-IP>`          |
| **PuTTY**                | Windows     | GUI-based SSH client (convert `.pem` → `.ppk`) |
| **EC2 Instance Connect** | AWS Console | Browser-based SSH (no key required locally)    |

**Tip:** Always keep a separate **Security Group just for SSH (port 22)** — helps you control admin access easily.

---

## 🧠 Quick Visual Summary

```
                 ┌────────────────────────┐
                 │      Security Group     │
                 │   (acts like firewall)  │
                 └──────────┬──────────────┘
                            │
            ┌───────────────┼────────────────┐
            ▼                                   ▼
      Inbound Rules                       Outbound Rules
   (Traffic coming in)               (Traffic going out)
   Default: Blocked ❌               Default: Allowed ✅
```

---

## 💰 EC2 Purchasing Options — The Big Picture

AWS gives multiple ways to pay for EC2 so you can balance **cost, flexibility, and reliability**.

| Type                        | Commitment                | Flexibility            | Discount    | Ideal Use Case                        |
| --------------------------- | ------------------------- | ---------------------- | ----------- | ------------------------------------- |
| **On-Demand**               | None                      | High                   | ❌ None      | Unpredictable or short workloads      |
| **Reserved Instances (RI)** | 1 or 3 years              | Medium                 | ✅ Up to 72% | Steady workloads (databases, servers) |
| **Savings Plans**           | 1 or 3 years              | High                   | ✅ Up to 72% | Long-term workloads but flexible      |
| **Spot Instances**          | None                      | Low (can stop anytime) | ✅ Up to 90% | Fault-tolerant, batch jobs            |
| **Dedicated Hosts**         | 1 or 3 years or on-demand | None                   | ❌ Expensive | Compliance or license-bound workloads |
| **Dedicated Instances**     | None                      | Medium                 | ❌ Expensive | Same as above, but less control       |
| **Capacity Reservations**   | Any duration              | Medium                 | ❌ None      | Guarantee capacity in a specific AZ   |

---

## 🕒 1️⃣ EC2 **On-Demand Instances**

💡 **“Pay as you go”**

* **Billing:** per second (Linux/Windows) or per hour (others)
* **No upfront**, **no commitment**
* **Most expensive**, but **most flexible**
* Best for:

  * New or unpredictable apps
  * Development, testing, POCs

🧩 **Example:** You run your EC2 web app only during office hours.

---

## 💡 2️⃣ **Reserved Instances (RIs)**

💰 Save up to **72% vs On-Demand** by committing for **1 or 3 years**

You “reserve” a specific instance type, region, and OS.

| Term   | Discount | Payment Options            |
| ------ | -------- | -------------------------- |
| 1 Year | Good     | No / Partial / All Upfront |
| 3 Year | Best     | No / Partial / All Upfront |

🧩 **Use Case:** Steady workloads like databases or always-on servers.

---

### 🌀 **Convertible Reserved Instances**

* Up to **66% discount**
* You can **change instance type, family, OS, region, or tenancy**
* Great when you expect **future changes** but still want savings.

---

## 💳 3️⃣ **Savings Plans**

Think of this as **a more flexible Reserved Instance**.

* Commit to **spending ($/hour)** for 1 or 3 years
  → e.g., `$10/hour` of compute
* Get same **up to 72% discount**
* Flexible across:

  * Instance size (m5.xlarge → m5.2xlarge)
  * OS (Linux, Windows)
  * Tenancy (Shared, Dedicated)
* Not tied to a specific instance ID

🧩 **Use Case:** Long-term workloads that may change types (e.g., autoscaling environments)

---

## ⚡ 4️⃣ **Spot Instances**

💰 **Up to 90% cheaper**
💥 BUT AWS can **terminate anytime** when demand rises.

* You “bid” for unused EC2 capacity.
* If spot price > your bid → instance stops.
* AWS gives **2-minute warning** before termination.

🧩 **Great for:**

* Batch jobs
* Data analysis
* Image/video processing
* Machine learning training
* CI/CD pipelines

🚫 **Not for:**

* Databases
* Critical or stateful apps

---

## 🧱 5️⃣ **Dedicated Hosts**

You get **an entire physical server** exclusively for your use.

| Feature               | Description                                        |
| --------------------- | -------------------------------------------------- |
| Full physical control | No one else shares your host                       |
| BYOL                  | Bring your own licenses (per-core, per-socket)     |
| Compliance            | Meet regulatory or security isolation requirements |
| Cost                  | 💸 Most expensive                                  |

🧩 **Use Case:**
When compliance or software licensing rules require physical isolation.

---

## 🧩 6️⃣ **Dedicated Instances**

* Your EC2 runs on hardware **dedicated to your account**
* AWS still manages placement (no control over host)
* Can **share hardware** with other instances in *your account*
* Slightly cheaper than Dedicated Hosts

🧩 **Use Case:**
When you need isolation but don’t care about host-level control.

---

## 🧭 7️⃣ **Capacity Reservations**

* **Guarantee capacity** in a specific Availability Zone (AZ)
* **No commitment** — can create or cancel anytime
* **Pay On-Demand rate**, even if not running
* Combine with RIs or Savings Plans for discounts

🧩 **Use Case:**
When you need **guaranteed capacity** (e.g., during peak events or DR failover).

---

## 🏨 Easy Hotel Analogy (Perfect for remembering)

| Option                   | Analogy                                            | Key Idea                            |
| ------------------------ | -------------------------------------------------- | ----------------------------------- |
| **On-Demand**            | Walk into hotel anytime, pay full price per night  | Flexible but expensive              |
| **Reserved**             | Book long stay at same room → discount             | Commitment saves money              |
| **Savings Plans**        | Commit to spend per hour, stay in any room type    | Flexibility + savings               |
| **Spot**                 | Bid for leftover rooms, may get kicked out anytime | Cheap but unreliable                |
| **Dedicated Host**       | Rent an entire building                            | Total control, expensive            |
| **Capacity Reservation** | Book a room even if you don’t use it               | Pay full price for guaranteed space |

---

## 💵 Example Price Comparison (m4.large – us-east-1)

| Type                 | Hourly Cost                                | Notes                   |
| -------------------- | ------------------------------------------ | ----------------------- |
| On-Demand            | $0.10                                      | Base rate               |
| Spot                 | $0.038–$0.039                              | ~61% off                |
| RI (1yr)             | $0.062 (No Upfront) – $0.058 (All Upfront) | 38–42% off              |
| RI (3yr)             | $0.043 – $0.037                            | 57–63% off              |
| Convertible RI (1yr) | $0.071 – $0.066                            | ~34% off                |
| Savings Plan (1yr)   | $0.062 – $0.058                            | ~40% off                |
| Dedicated Host       | Highest                                    | Full physical server    |
| Capacity Reservation | $0.10                                      | Full price, no discount |

---

## 🧠 In Short — Choosing Strategy

| Scenario                        | Best Option                       |
| ------------------------------- | --------------------------------- |
| **Testing or temporary app**    | On-Demand                         |
| **Predictable steady load**     | Reserved Instance or Savings Plan |
| **Batch or flexible job**       | Spot Instances                    |
| **Compliance or license needs** | Dedicated Host                    |
| **Need guaranteed capacity**    | Capacity Reservation              |

---
